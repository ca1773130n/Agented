---
phase: 06-code-quality-and-maintainability
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/app/db/seeds.py
  - backend/app/db/migrations.py
  - backend/app/db/__init__.py
autonomous: true
verification_level: proxy

must_haves:
  truths:
    - "`backend/app/db/seeds.py` exists and contains all 4 seed functions (`seed_predefined_triggers`, `seed_preset_mcp_servers`, `migrate_existing_paths`, `auto_register_project_root`) plus the `PRESET_MCP_SERVERS` data constant"
    - "`migrations.py` no longer contains any seed functions or `PRESET_MCP_SERVERS`; it retains only schema migration code (`init_db`, `VERSIONED_MIGRATIONS`, `_migrate_*` functions) and its own constants (`VALID_BACKENDS`, `PREDEFINED_TRIGGERS`, etc.)"
    - "`cd backend && uv run python -c \"from app.db.seeds import seed_predefined_triggers\"` exits 0"
    - "`cd backend && uv run python -c \"from app.db import seed_predefined_triggers\"` exits 0 (re-export chain intact)"
    - "`cd backend && uv run pytest` passes at 100% with no test modifications"
  artifacts:
    - path: "backend/app/db/seeds.py"
      provides: "Seed functions and PRESET_MCP_SERVERS data constant extracted from migrations.py"
      min_lines: 150
  key_links:
    - from: "backend/app/db/__init__.py"
      to: "backend/app/db/seeds.py"
      via: "import re-export of seed functions"
      pattern: "from \\.seeds import"
    - from: "backend/app/db/seeds.py"
      to: "backend/app/db/migrations.py"
      via: "imports PREDEFINED_TRIGGERS and related constants"
      pattern: "from \\.migrations import PREDEFINED_TRIGGER"
    - from: "backend/app/__init__.py"
      to: "backend/app/db/__init__.py"
      via: "imports seed functions at startup"
      pattern: "seed_predefined_triggers|seed_preset_mcp_servers|migrate_existing_paths|auto_register_project_root"
---

<objective>
Extract all seeding functions and their data constants from `migrations.py` into a dedicated `seeds.py` module, so that `migrations.py` remains a pure schema-evolution record.

Purpose: Separating seeds from migrations is industry-standard (Django fixtures, Rails db/seeds.rb). The current `migrations.py` is 3,220 lines with seed functions occupying lines 3034-3221. Moving them clarifies the migration history and allows seed updates without touching the migration file.

Output: `backend/app/db/seeds.py` with 4 seed functions and `PRESET_MCP_SERVERS` data; updated `__init__.py` re-exports; cleaned `migrations.py`.
</objective>

<execution_context>
@.planning/milestones/v0.1.0/phases/06-code-quality-and-maintainability/06-RESEARCH.md
</execution_context>

<context>
@.planning/codebase/ARCHITECTURE.md
@backend/app/db/__init__.py
@backend/app/db/migrations.py
@backend/app/database.py
@backend/app/__init__.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create seeds.py with extracted seed functions and data</name>
  <files>backend/app/db/seeds.py, backend/app/db/migrations.py</files>
  <action>
    Create `backend/app/db/seeds.py` containing:

    1. **Module docstring** explaining this file contains seed data and startup functions separated from migrations.py.

    2. **Imports:** `logging`, `os`, `sqlite3`, `app.config as config`, `.connection.get_connection`, `.ids._get_unique_mcp_server_id`.

    3. **`PRESET_MCP_SERVERS` list** -- move the entire list (currently at `migrations.py` lines 2723-2851) into this file. This is the only large data constant that needs to move. The `PREDEFINED_TRIGGERS`, `PREDEFINED_TRIGGER_ID`, `PREDEFINED_TRIGGER_IDS`, `PREDEFINED_TRIGGER`, `VALID_BACKENDS`, and `VALID_TRIGGER_SOURCES` constants are already canonically defined in `triggers.py` (lines 24-64) and re-exported from `__init__.py`. They are DUPLICATED in `migrations.py` for historical reasons. The migration functions that reference them (`_migrate_to_string_ids` at line 383, `_create_migration_only_tables` at line 255) use the copies local to `migrations.py` -- leave those copies in place so migration functions continue to work without cross-module imports.

    4. **Four seed functions** -- move these verbatim from `migrations.py`:
       - `seed_predefined_triggers()` (lines 3039-3093) -- uses `PREDEFINED_TRIGGERS` from migrations.py. In seeds.py, import `PREDEFINED_TRIGGERS` from `.triggers` instead (the canonical source).
       - `seed_preset_mcp_servers()` (lines 3096-3154) -- uses `PRESET_MCP_SERVERS` which is now local to seeds.py.
       - `migrate_existing_paths()` (lines 3162-3187) -- has lazy imports from `app.database` for `_create_symlink`, `_generate_symlink_name`. Keep these lazy imports.
       - `auto_register_project_root()` (lines 3190-3221) -- has lazy imports from `app.database` for `_create_symlink`, `_generate_symlink_name`, `_remove_symlink`. Keep these lazy imports. Uses `PREDEFINED_TRIGGER_ID` -- import from `.triggers`.

    5. **Remove from `migrations.py`:** Delete the entire "Seeding" section (lines 3034-3221), the "Path migration helpers" section header (lines 3157-3160), and the `PRESET_MCP_SERVERS` list (lines 2718-2851). Do NOT remove `VALID_BACKENDS`, `PREDEFINED_TRIGGERS`, `PREDEFINED_TRIGGER_ID`, etc. from migrations.py -- those are used by migration functions and must remain.

    **Pitfall avoidance (from RESEARCH.md Pitfall 1 & 5):**
    - `seeds.py` imports from `.triggers` (not `.migrations`) to get `PREDEFINED_TRIGGERS` and `PREDEFINED_TRIGGER_ID`. This avoids circular imports.
    - `migrations.py` does NOT import from `seeds.py`. The constants remain duplicated between `migrations.py` and `triggers.py` -- this is intentional for migration function isolation.
    - The lazy imports from `app.database` in `migrate_existing_paths` and `auto_register_project_root` must be preserved to avoid circular imports during the database.py shim initialization.
  </action>
  <verify>
    cd backend && uv run python -c "from app.db.seeds import seed_predefined_triggers, seed_preset_mcp_servers, migrate_existing_paths, auto_register_project_root, PRESET_MCP_SERVERS; print('OK')" (Level 1: Sanity)
  </verify>
  <done>
    `seeds.py` exists with all 4 seed functions and `PRESET_MCP_SERVERS`. `migrations.py` no longer contains seed functions or `PRESET_MCP_SERVERS`.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update __init__.py re-exports and verify full test suite</name>
  <files>backend/app/db/__init__.py</files>
  <action>
    1. In `backend/app/db/__init__.py`, change the import block that currently reads:
       ```python
       from .migrations import (  # noqa: F401
           auto_register_project_root,
           init_db,
           migrate_existing_paths,
           seed_predefined_triggers,
           seed_preset_mcp_servers,
       )
       ```
       To split into two imports:
       ```python
       from .migrations import init_db  # noqa: F401
       from .seeds import (  # noqa: F401
           auto_register_project_root,
           migrate_existing_paths,
           seed_predefined_triggers,
           seed_preset_mcp_servers,
       )
       ```

    2. Verify the full import chain works:
       - `from app.db import seed_predefined_triggers` resolves via `__init__.py -> seeds.py`
       - `from app.db import init_db` resolves via `__init__.py -> migrations.py`
       - `from app.database import seed_predefined_triggers` resolves via `database.py -> app.db -> seeds.py`
       - The app factory in `backend/app/__init__.py` (lines 88-101) imports `seed_predefined_triggers`, `seed_preset_mcp_servers`, `migrate_existing_paths`, `auto_register_project_root` -- these must still resolve.

    3. Run `cd backend && uv run pytest` to verify 100% pass rate with zero test modifications.

    **Pitfall avoidance (from RESEARCH.md Pitfall 3):**
    - The `__init__.py` re-export update is the critical link. Existing code that does `from app.db import seed_predefined_triggers` will now resolve through seeds.py instead of migrations.py.
    - The `database.py` shim (`from app.db import *`) requires no changes since it re-exports everything from `__init__.py`.
  </action>
  <verify>
    cd backend && uv run python -c "from app.db import seed_predefined_triggers, init_db; print('OK')" && uv run python -c "from app.database import seed_predefined_triggers; print('OK')" && uv run pytest --tb=short (Level 2: Proxy)
  </verify>
  <done>
    `__init__.py` imports seed functions from `.seeds` and `init_db` from `.migrations`. Full test suite passes. Import chain from `app.database` through to `seeds.py` is intact.
  </done>
</task>

</tasks>

<verification>
Level 1 (Sanity):
- `cd backend && uv run python -c "from app.db.seeds import seed_predefined_triggers"` exits 0
- `cd backend && uv run python -c "from app.db.seeds import PRESET_MCP_SERVERS; print(len(PRESET_MCP_SERVERS))"` prints a positive integer
- `grep -c "def seed_" backend/app/db/migrations.py` returns 0 (no seed functions remain)

Level 2 (Proxy):
- `cd backend && uv run pytest` passes at 100%
- `cd backend && uv run pytest tests/test_migration_path.py` passes (migration-specific tests unaffected)
</verification>

<success_criteria>
- `backend/app/db/seeds.py` exists with 4 seed functions and `PRESET_MCP_SERVERS`
- `migrations.py` contains only schema migration code (no seed functions, no `PRESET_MCP_SERVERS`)
- All imports resolve correctly through `__init__.py`, `database.py`, and `app/__init__.py`
- Full test suite passes with zero modifications to test files
</success_criteria>

<output>
After completion, create `.planning/milestones/v0.1.0/phases/06-code-quality-and-maintainability/06-01-SUMMARY.md`
</output>
