---
phase: 06-code-quality-and-maintainability
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - backend/pyproject.toml
  - CLAUDE.md
autonomous: true
verification_level: sanity

must_haves:
  truths:
    - "`cd backend && uv run ruff check .` exits with code 0"
    - "`cd backend && uv run ruff format --check .` exits with code 0"
    - "`pyproject.toml` has a `[tool.ruff.format]` section and no `[tool.black]` section"
    - "`black` is not listed in any dependency section of `pyproject.toml`"
    - "`CLAUDE.md` references `ruff format` instead of `black` for Python formatting"
  artifacts:
    - path: "backend/pyproject.toml"
      provides: "Ruff configuration as sole linter/formatter"
      contains: "[tool.ruff.format]"
  key_links:
    - from: "backend/pyproject.toml"
      to: "backend/**/*.py"
      via: "ruff format configuration"
      pattern: "\\[tool.ruff.format\\]"
---

<objective>
Replace Black with Ruff as the sole Python linter and formatter. Configure `[tool.ruff.format]` in `pyproject.toml`, remove all Black configuration and dependencies, fix any lint errors, and reformat the entire codebase.

Purpose: Ruff is already installed (>=0.9.7) and partially configured as a linter. Adding the formatter section and removing Black simplifies the toolchain from 2 tools to 1, with 10-100x faster formatting (per Ruff documentation, astral.sh/ruff). The project currently has 2 lint errors and 29 files needing reformatting.

Output: Clean `pyproject.toml` with Ruff-only config; all Python files passing `ruff check` and `ruff format --check`; updated `CLAUDE.md` docs.
</objective>

<execution_context>
@.planning/milestones/v0.1.0/phases/06-code-quality-and-maintainability/06-RESEARCH.md
</execution_context>

<context>
@backend/pyproject.toml
@CLAUDE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update pyproject.toml -- remove Black, configure Ruff formatter</name>
  <files>backend/pyproject.toml, CLAUDE.md</files>
  <action>
    1. **Remove Black from dependencies:**
       - In `[project.optional-dependencies] dev`, remove `"black==26.1.0"` from the list.
       - The `[dependency-groups] dev` section already has `ruff>=0.9.7` and does not list Black -- no change needed there.

    2. **Remove `[tool.black]` section entirely:**
       - Delete the `[tool.black]` section (lines 38-40: `line-length = 100`, `target-version = ["py310"]`).

    3. **Add `[tool.ruff.format]` section** (per Ruff documentation, Context7 /websites/astral_sh_ruff):
       ```toml
       [tool.ruff.format]
       quote-style = "double"
       indent-style = "space"
       skip-magic-trailing-comma = false
       line-ending = "auto"
       ```
       Place this section after the existing `[tool.ruff.lint]` block.

    4. **Add `[tool.ruff.lint.per-file-ignores]`** to suppress expected warnings in `__init__.py` barrel files:
       ```toml
       [tool.ruff.lint.per-file-ignores]
       "__init__.py" = ["F401", "F403"]
       ```

    5. **Add `fixable` to lint config** to enable auto-fix for import sorting:
       Add `fixable = ["ALL"]` to the `[tool.ruff.lint]` section.

    6. **Update `CLAUDE.md`:**
       - Change `cd backend && uv run black .` to `cd backend && uv run ruff format .` in the Formatting section.
       - Change `Python formatting: Black with \`line-length=100\`, target \`py310\`` to `Python formatting: Ruff with \`line-length=100\`, target \`py310\`` in the Conventions section.
  </action>
  <verify>
    grep -q "[tool.ruff.format]" backend/pyproject.toml && ! grep -q "[tool.black]" backend/pyproject.toml && echo "Config OK" (Level 1: Sanity)
  </verify>
  <done>
    `pyproject.toml` has Ruff formatter config, no Black config, no Black dependency. `CLAUDE.md` references Ruff.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix lint errors and reformat all Python files with Ruff</name>
  <files>backend/**/*.py</files>
  <action>
    1. **Fix lint errors first:**
       ```bash
       cd backend && uv run ruff check . --fix
       ```
       The research found 2 lint errors (import sorting). The `--fix` flag with `fixable = ["ALL"]` will auto-fix them.

    2. **Reformat all files:**
       ```bash
       cd backend && uv run ruff format .
       ```
       This will reformat the 29 files that differ from Ruff's formatting rules. Ruff's formatter is Black-compatible for 99.9% of cases (per Ruff documentation). Differences are cosmetic (trailing comma handling, string quote normalization).

    3. **Verify clean state:**
       ```bash
       cd backend && uv run ruff check . && uv run ruff format --check .
       ```
       Both must exit 0.

    4. **Run full test suite** to confirm formatting changes don't break anything:
       ```bash
       cd backend && uv run pytest --tb=short
       ```

    **Pitfall avoidance (from RESEARCH.md Pitfall 2):**
    - The configuration change (Task 1) and the reformatting (Task 2) are in the same plan but should produce distinct mental checkpoints. The config change is the meaningful delta; the reformatting is mechanical.
  </action>
  <verify>
    cd backend && uv run ruff check . && uv run ruff format --check . && uv run pytest --tb=short (Level 1: Sanity + Level 2: Proxy)
  </verify>
  <done>
    `ruff check .` exits 0. `ruff format --check .` exits 0. All tests pass. Zero lint errors across the codebase.
  </done>
</task>

</tasks>

<verification>
Level 1 (Sanity):
- `cd backend && uv run ruff check .` exits 0
- `cd backend && uv run ruff format --check .` exits 0
- `grep -q "\[tool.black\]" backend/pyproject.toml` returns non-zero (no Black config)
- `grep -q "black" backend/pyproject.toml` returns non-zero (no Black dependency)
- `grep -q "ruff format" CLAUDE.md` returns 0 (docs updated)

Level 2 (Proxy):
- `cd backend && uv run pytest` passes at 100%
</verification>

<success_criteria>
- `ruff check .` and `ruff format --check .` both exit 0
- No `[tool.black]` section in `pyproject.toml`
- No `black` in any dependency list in `pyproject.toml`
- `[tool.ruff.format]` section present with `quote-style`, `indent-style`, `skip-magic-trailing-comma`, `line-ending`
- `CLAUDE.md` references Ruff, not Black, for formatting
- Full test suite passes
</success_criteria>

<output>
After completion, create `.planning/milestones/v0.1.0/phases/06-code-quality-and-maintainability/06-02-SUMMARY.md`
</output>
