---
phase: 01-web-ui-roadmapping-feature
plan: 05
type: execute
wave: 3
depends_on: ["01-03", "01-04"]
files_modified:
  - frontend/src/views/ProjectDashboard.vue
  - frontend/src/components/settings/GrdSettings.vue
  - frontend/src/views/SettingsPage.vue
  - frontend/src/components/layout/AppSidebar.vue
autonomous: true
verification_level: proxy

must_haves:
  truths:
    - "ProjectDashboard shows a 'Planning' button that navigates to /projects/:projectId/planning"
    - "Planning button is placed left of the existing 'Management' button per CONTEXT.md"
    - "ProjectDashboard shows GRD initialization status indicator (initializing/ready/failed)"
    - "SettingsPage has a 'grd' tab that renders GrdSettings component"
    - "GrdSettings component displays GRD configuration options"
    - "AppSidebar project items include a planning link for quick navigation"
  artifacts:
    - path: "frontend/src/components/settings/GrdSettings.vue"
      provides: "GRD settings tab component"
      min_lines: 50
    - path: "frontend/src/views/SettingsPage.vue"
      provides: "Extended tab list including 'grd' tab"
      contains: "grd"
    - path: "frontend/src/views/ProjectDashboard.vue"
      provides: "Planning button and init status indicator"
      contains: "project-planning"
  key_links:
    - from: "frontend/src/views/ProjectDashboard.vue"
      to: "frontend/src/router/routes/projects.ts"
      via: "router.push to planning route"
      pattern: "project-planning"
    - from: "frontend/src/views/SettingsPage.vue"
      to: "frontend/src/components/settings/GrdSettings.vue"
      via: "component import and conditional render"
      pattern: "GrdSettings"
---

<objective>
Wire navigation from ProjectDashboard to the Planning page, add GRD initialization status display, and create the GRD settings tab on the Settings page.

Purpose: Complete the user journey by connecting the Planning page to the rest of the application. Users need clear entry points (dashboard button, sidebar link), feedback on auto-initialization progress, and a settings interface for GRD configuration.

Output: Updated ProjectDashboard with Planning button + init status, GrdSettings component, extended SettingsPage tabs, updated AppSidebar.
</objective>

<execution_context>
@.planning/milestones/v0.1.0/phases/01-web-ui-roadmapping-feature/01-CONTEXT.md
@.planning/milestones/v0.1.0/phases/01-web-ui-roadmapping-feature/01-RESEARCH.md
@.planning/milestones/v0.1.0/phases/01-web-ui-roadmapping-feature/01-03-SUMMARY.md
@.planning/milestones/v0.1.0/phases/01-web-ui-roadmapping-feature/01-04-SUMMARY.md
@frontend/src/views/ProjectDashboard.vue
@frontend/src/views/SettingsPage.vue
@frontend/src/components/layout/AppSidebar.vue
</execution_context>

<tasks>

<task type="auto">
  <name>Task 1: Add Planning button and init status to ProjectDashboard</name>
  <files>frontend/src/views/ProjectDashboard.vue</files>
  <action>
    Modify `frontend/src/views/ProjectDashboard.vue` to add a Planning navigation button and GRD initialization status indicator.

    **Changes to script setup:**

    1. Import `grdApi` alongside the existing `projectApi` import:
       ```typescript
       import { projectApi, grdApi, hookApi, commandApi, ruleApi, agentApi, teamApi, ApiError } from '../services/api';
       ```

    2. Add reactive state for GRD init status:
       ```typescript
       const grdInitStatus = ref<string>('none');
       const isLoadingGrdStatus = ref(false);
       ```

    3. Add a function to fetch GRD init status:
       ```typescript
       async function loadGrdStatus() {
         if (!projectId.value) return;
         try {
           isLoadingGrdStatus.value = true;
           const result = await grdApi.getPlanningStatus(projectId.value);
           grdInitStatus.value = result.grd_init_status;
         } catch (e) {
           // Non-critical — just show 'none' status
           grdInitStatus.value = 'none';
         } finally {
           isLoadingGrdStatus.value = false;
         }
       }
       ```

    4. Call `loadGrdStatus()` in the existing `onMounted` or `loadProject` function, after the project is loaded.

    5. Add navigation functions:
       ```typescript
       function goToPlanning() {
         router.push({ name: 'project-planning', params: { projectId: projectId.value } });
       }
       function goToManagement() {
         router.push({ name: 'project-management', params: { projectId: projectId.value } });
       }
       ```

    **Changes to template:**

    Find the section where navigation buttons are rendered (near "Management" button or project actions area). Add a "Planning" button LEFT of the "Management" button per CONTEXT.md:

    ```html
    <div class="project-actions">
      <button class="btn btn-secondary" @click="goToPlanning">
        <span class="btn-icon">&#9881;</span> Planning
        <span v-if="grdInitStatus === 'initializing'" class="init-badge init-badge--loading" title="GRD initializing...">...</span>
        <span v-else-if="grdInitStatus === 'ready'" class="init-badge init-badge--ready" title="Planning ready">&#10003;</span>
        <span v-else-if="grdInitStatus === 'failed'" class="init-badge init-badge--failed" title="Initialization failed">!</span>
      </button>
      <button class="btn btn-secondary" @click="goToManagement">
        <span class="btn-icon">&#9776;</span> Management
      </button>
      <!-- ...existing buttons like Settings... -->
    </div>
    ```

    If the dashboard uses a different pattern for action buttons (inspect the actual template), adapt accordingly. The key requirements are:
    - Planning button exists and navigates to `/projects/:projectId/planning`
    - Planning button is positioned LEFT of Management button
    - Init status badge shows on the Planning button

    **Changes to styles (scoped):**

    Add styles for the init status badges:
    ```css
    .init-badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      font-size: 10px;
      margin-left: 6px;
    }
    .init-badge--loading {
      background: var(--color-warning, #f59e0b);
      color: #000;
      animation: pulse 1.5s ease-in-out infinite;
    }
    .init-badge--ready {
      background: var(--color-success, #10b981);
      color: #fff;
    }
    .init-badge--failed {
      background: var(--color-error, #ef4444);
      color: #fff;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    ```

    Also add a polling mechanism: if `grdInitStatus === 'initializing'`, set up a 5-second interval to re-fetch status until it changes to `ready` or `failed`. When the status transitions to a terminal state, show an active toast notification (per CONTEXT.md: "user is notified on completion"):
    ```typescript
    let initPollInterval: ReturnType<typeof setInterval> | null = null;

    watch(grdInitStatus, (newVal, oldVal) => {
      if (newVal === 'initializing' && !initPollInterval) {
        initPollInterval = setInterval(loadGrdStatus, 5000);
      } else if (newVal !== 'initializing' && initPollInterval) {
        clearInterval(initPollInterval);
        initPollInterval = null;
      }
      // Active toast notification when auto-init finishes (not just passive badge)
      if (oldVal === 'initializing' && newVal === 'ready') {
        showToast('GRD planning initialized successfully', 'success');
      } else if (oldVal === 'initializing' && newVal === 'failed') {
        showToast('GRD planning initialization failed', 'error');
      }
    });

    onUnmounted(() => {
      if (initPollInterval) clearInterval(initPollInterval);
    });
    ```

    Make sure `useToast()` is imported (it should already be used for error notifications in this component). If `onUnmounted` is not already imported, add it to the vue imports.
  </action>
  <verify>
    cd frontend && npm run build
    (Level 1: Sanity — build passes)

    Navigate to /projects/{id} — Planning button visible, left of Management button
    Click Planning button — navigates to /projects/{id}/planning
    (Level 2: Proxy — navigation works, status indicator shows)
  </verify>
  <done>
    ProjectDashboard has a Planning button that navigates to the planning page. GRD init status shows as a badge (loading/ready/failed). Button is left of Management. Polling updates status when initializing.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create GrdSettings component and add 'grd' tab to SettingsPage</name>
  <files>frontend/src/components/settings/GrdSettings.vue, frontend/src/views/SettingsPage.vue, frontend/src/components/layout/AppSidebar.vue</files>
  <action>
    **Component: GrdSettings.vue** (`frontend/src/components/settings/GrdSettings.vue`)

    Create a settings component for GRD configuration. This is the initial version — it provides a useful settings interface even though most GRD config is in `.planning/config.json`.

    ```vue
    <script setup lang="ts">
    import { ref, onMounted } from 'vue';
    import { settingsApi, ApiError } from '../../services/api';
    import { useToast } from '../../composables/useToast';

    const showToast = useToast();

    // GRD settings state
    const autoInitEnabled = ref(true);
    const syncOnSessionComplete = ref(true);
    const defaultVerificationLevel = ref('proxy');
    const isLoading = ref(true);
    const isSaving = ref(false);

    async function loadSettings() {
      try {
        isLoading.value = true;
        // Load from settings API (key-value store)
        // IMPORTANT: settingsApi.getAll() returns { settings: Record<string, string> } — must destructure
        const { settings: allSettings } = await settingsApi.getAll();
        autoInitEnabled.value = allSettings['grd.auto_init_enabled'] !== 'false';
        syncOnSessionComplete.value = allSettings['grd.sync_on_complete'] !== 'false';
        defaultVerificationLevel.value = allSettings['grd.default_verification_level'] || 'proxy';
      } catch (e) {
        // Settings may not exist yet — use defaults
      } finally {
        isLoading.value = false;
      }
    }

    async function saveSettings() {
      try {
        isSaving.value = true;
        await settingsApi.set('grd.auto_init_enabled', String(autoInitEnabled.value));
        await settingsApi.set('grd.sync_on_complete', String(syncOnSessionComplete.value));
        await settingsApi.set('grd.default_verification_level', defaultVerificationLevel.value);
        showToast('GRD settings saved', 'success');
      } catch (e) {
        showToast('Failed to save GRD settings', 'error');
      } finally {
        isSaving.value = false;
      }
    }

    onMounted(loadSettings);
    </script>

    <template>
      <div class="grd-settings" v-if="!isLoading">
        <div class="settings-section">
          <h3>Project Initialization</h3>
          <label class="setting-row">
            <input type="checkbox" v-model="autoInitEnabled" />
            <div>
              <span class="setting-label">Auto-initialize GRD on project creation</span>
              <span class="setting-description">Automatically run map-codebase and new-project when a project is created</span>
            </div>
          </label>
        </div>

        <div class="settings-section">
          <h3>Sync Behavior</h3>
          <label class="setting-row">
            <input type="checkbox" v-model="syncOnSessionComplete" />
            <div>
              <span class="setting-label">Sync on session completion</span>
              <span class="setting-description">Automatically sync .planning/ files to database when a planning session completes</span>
            </div>
          </label>
        </div>

        <div class="settings-section">
          <h3>Default Verification Level</h3>
          <select v-model="defaultVerificationLevel" class="setting-select">
            <option value="sanity">Sanity</option>
            <option value="proxy">Proxy</option>
            <option value="deferred">Deferred</option>
          </select>
          <span class="setting-description">Default verification level for new phases</span>
        </div>

        <div class="settings-actions">
          <button class="btn btn-primary" :disabled="isSaving" @click="saveSettings">
            {{ isSaving ? 'Saving...' : 'Save Settings' }}
          </button>
        </div>
      </div>
      <div v-else class="loading-state">Loading GRD settings...</div>
    </template>
    ```

    Add scoped styles matching the existing settings components (inspect `GeneralSettings.vue` or `McpSettings.vue` for the CSS patterns — `.settings-section`, `.setting-row`, `.setting-label`, `.setting-description`, `.setting-select`, `.settings-actions`).

    **Extend SettingsPage** (`frontend/src/views/SettingsPage.vue`)

    1. Import the new component:
       ```typescript
       import GrdSettings from '../components/settings/GrdSettings.vue';
       ```

    2. Extend the `TAB_NAMES` tuple — add `'grd'` after `'mcp'`:
       ```typescript
       const TAB_NAMES = ['general', 'marketplaces', 'harness', 'mcp', 'grd'] as const;
       ```

    3. Update the `getTabFromHash()` return type and the `activeTab` ref type to include `'grd'`.

    4. Add the GRD tab button in the template's tab bar (find the existing tab buttons and add one for 'grd'):
       ```html
       <button
         :class="['tab-btn', { active: activeTab === 'grd' }]"
         @click="activeTab = 'grd'; window.location.hash = 'grd'"
       >
         GRD Planning
       </button>
       ```

    5. Add the GRD tab content panel (find the existing `v-if` conditional renders for each tab):
       ```html
       <GrdSettings v-if="activeTab === 'grd'" />
       ```

    **Update AppSidebar** (`frontend/src/components/layout/AppSidebar.vue`)

    This is a large file (46k). Make a minimal, targeted change:

    Find the section where project links are rendered in the sidebar (look for where `projects` are iterated to create navigation links). For each project, if there's already a sub-link or hover menu, add a "Planning" link that navigates to `/projects/:projectId/planning`. If projects are rendered as simple links without sub-menus, skip this change — the ProjectDashboard button is the primary entry point.

    If the sidebar change is too complex or risky (given the file size), skip it. The Planning button on ProjectDashboard is sufficient per CONTEXT.md requirements.
  </action>
  <verify>
    cd frontend && npm run build
    (Level 1: Sanity — build passes)

    Navigate to /settings#grd — GRD Settings tab renders
    Navigate to /projects/{id} — Planning button visible
    (Level 2: Proxy — both entry points work)
  </verify>
  <done>
    GrdSettings component renders with auto-init toggle, sync toggle, and verification level selector. SettingsPage has 'grd' tab. ProjectDashboard Planning button navigates to planning page with init status badge. Build passes.
  </done>
</task>

</tasks>

<verification>
Level 1 (Sanity):
- `just build` succeeds
- `cd frontend && npm run test:run` passes
- `cd backend && uv run pytest` passes

Level 2 (Proxy):
- Navigate to `/projects/{id}` — "Planning" button visible, left of "Management"
- Click "Planning" — navigates to `/projects/{id}/planning`
- Navigate to `/settings#grd` — GRD tab renders settings form
- Save settings — success toast appears
- Create a new project — grd_init_status appears in response
- Planning button shows init status badge (initializing → ready animation)

Level 3 (Deferred):
- Verify all 17 commands launchable from Planning page
- Verify Settings actually affect backend behavior (auto-init toggle)
- Cross-browser testing of SSE reconnect
</verification>

<success_criteria>
ProjectDashboard has Planning button with init status badge. SettingsPage has GRD tab with configuration options. Navigation from dashboard to planning page works. Build and all tests pass.
</success_criteria>

<output>
After completion, create `.planning/milestones/v0.1.0/phases/01-web-ui-roadmapping-feature/01-05-SUMMARY.md`
</output>
